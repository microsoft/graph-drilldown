{"remainingRequest":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\babel-loader-virtual-fd8dd261de\\0\\cache\\babel-loader-npm-8.2.2-b4e600c2c5-df5092ef98.zip\\node_modules\\babel-loader\\lib\\index.js??ruleSet[1].rules[0].use[1]!C:\\ws\\graph-drill\\.yarn\\__virtual__\\ts-loader-virtual-aa0d54d245\\0\\cache\\ts-loader-npm-9.2.1-40e1a5908e-1f2e61905d.zip\\node_modules\\ts-loader\\index.js??ruleSet[1].rules[0].use[2]!C:\\ws\\graph-drill\\src\\state\\vis\\nodeSize.ts","dependencies":[{"path":"C:\\ws\\graph-drill\\src\\state\\vis\\nodeSize.ts","mtime":1631029334917},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\cache-loader-virtual-2fd14a2267\\0\\cache\\cache-loader-npm-4.1.0-82c3da90d8-0339778bdd.zip\\node_modules\\cache-loader\\dist\\cjs.js","mtime":456789000000},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\babel-loader-virtual-fd8dd261de\\0\\cache\\babel-loader-npm-8.2.2-b4e600c2c5-df5092ef98.zip\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\ts-loader-virtual-aa0d54d245\\0\\cache\\ts-loader-npm-9.2.1-40e1a5908e-1f2e61905d.zip\\node_modules\\ts-loader\\index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgeyBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IH0ga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgovKiENCiAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0LiBBbGwgcmlnaHRzIHJlc2VydmVkLg0KICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLiBTZWUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0Lg0KICovCmltcG9ydCB7IFJPT1RfQ09NTVVOSVRZX0lEIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzJzsKaW1wb3J0IHsgY29tbXVuaXR5Tm9kZXNUYWJsZVN0YXRlIH0gZnJvbSAnLi4vdGFibGVzJzsKaW1wb3J0IHsgZ2V0RGVmYXVsdE51bWVyaWNPcHRpb25zIH0gZnJvbSAnLi9jb25maWcnOwppbXBvcnQgeyB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgYXRvbSwgYXRvbUZhbWlseSwgc2VsZWN0b3JGYW1pbHksIHVzZVJlY29pbFZhbHVlLCB1c2VTZXRSZWNvaWxTdGF0ZSB9IGZyb20gJ3JlY29pbCc7CmltcG9ydCB7IGdldENvbHVtblN0YXRzIH0gZnJvbSAnfi9hcnF1ZXJvJzsKZXhwb3J0IGNvbnN0IGZpZWxkU3RhdGUgPSBhdG9tKHsKICBrZXk6ICdub2RlLXNpemUtZW5jb2RpbmctZmllbGQnLAogIGRlZmF1bHQ6ICdub2RlLmQnCn0pOwpjb25zdCBlbmNvZGluZ1N0YXRlID0gYXRvbUZhbWlseSh7CiAga2V5OiAnbm9kZS1zaXplLWVuY29kaW5nLXN0YXRlJywKICBkZWZhdWx0OiBzZWxlY3RvckZhbWlseSh7CiAgICBrZXk6ICdub2RlLXNpemUtZW5jb2Rpbmctc3RhdGUtZGVmYXVsdCcsCiAgICBnZXQ6IGZpZWxkID0+ICh7CiAgICAgIGdldAogICAgfSkgPT4gewogICAgICAvLyBhbHdheXMgdXNlIHRoZSByb290IGZvciBzaXplLCB3aGljaCBoYXMgdGhlIHVuaXF1ZSBub2RlIGxpc3QKICAgICAgY29uc3QgcGlkID0gUk9PVF9DT01NVU5JVFlfSUQ7CiAgICAgIGNvbnN0IHRhYmxlID0gZ2V0KGNvbW11bml0eU5vZGVzVGFibGVTdGF0ZShwaWQpKTsKICAgICAgY29uc3Qgc3RhdHMgPSBnZXRDb2x1bW5TdGF0cyh0YWJsZSwgZmllbGQpOwogICAgICByZXR1cm4gZ2V0RGVmYXVsdE5vZGVTaXplT3B0aW9ucyhmaWVsZCwgc3RhdHMpOwogICAgfQogIH0pCn0pOwpleHBvcnQgZnVuY3Rpb24gdXNlTm9kZVNpemVFbmNvZGluZygpIHsKICBjb25zdCBmaWVsZCA9IHVzZVJlY29pbFZhbHVlKGZpZWxkU3RhdGUpOwogIHJldHVybiB1c2VSZWNvaWxWYWx1ZShlbmNvZGluZ1N0YXRlKGZpZWxkKSk7Cn0KZXhwb3J0IGZ1bmN0aW9uIHVzZVVwZGF0ZU5vZGVTaXplRW5jb2RpbmcoKSB7CiAgY29uc3QgZW5jb2RpbmcgPSB1c2VOb2RlU2l6ZUVuY29kaW5nKCk7CiAgY29uc3Qgc2V0dGVyID0gdXNlU2V0UmVjb2lsU3RhdGUoZW5jb2RpbmdTdGF0ZShlbmNvZGluZy5maWVsZCB8fCAnJykpOwogIGNvbnN0IGZpZWxkU2V0dGVyID0gdXNlU2V0UmVjb2lsU3RhdGUoZmllbGRTdGF0ZSk7CiAgcmV0dXJuIHVzZUNhbGxiYWNrKHVwZGF0ZSA9PiB7CiAgICBpZiAodXBkYXRlLmZpZWxkKSB7CiAgICAgIGZpZWxkU2V0dGVyKHVwZGF0ZS5maWVsZCk7CiAgICB9IGVsc2UgewogICAgICBzZXR0ZXIoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBlbmNvZGluZyksIHVwZGF0ZSkpOwogICAgfQogIH0sIFtlbmNvZGluZywgc2V0dGVyLCBmaWVsZFNldHRlcl0pOwp9CgpmdW5jdGlvbiBnZXREZWZhdWx0Tm9kZVNpemVPcHRpb25zKGZpZWxkLCBzdGF0cykgewogIC8vIFRPRE86IG1vc3QgZmllbGRzIHVzZSB0aGUgOTl0aCBxdWFudGlsZSwgYnV0IG5vZGUuZC9zaXplIGlzCiAgLy8gdmVyeSBwYXJ0aWN1bGFyIGZyb20gb3VyIGRhdGEgc2NpZW5jZSB0ZWFtLCBhbmQgcmVwcmVzZW50cwogIC8vIGEgc3BlY2lmaWMgcmFuZ2UgaW4gb3JkZXIgZm9yIG5vLW92ZXJsYXAgbGF5b3V0cyB0byBsb29rIGNvcnJlY3QKICAvLyBtYXliZSB3ZSBjYW4gZG8gYSBkb21haW4gY2hlY2sgYW5kIHVzZSBhIHNwZWNpYWwgY2FzZSBmb3IgdGhlc2U/CiAgcmV0dXJuIGdldERlZmF1bHROdW1lcmljT3B0aW9ucyhmaWVsZCwgc3RhdHMsIHsKICAgIHZhbHVlOiA0LAogICAgZG9tYWluOiBzdGF0cy5kb21haW4sCiAgICByYW5nZTogWzAuNSwgMTVdCiAgfSk7Cn0="},{"version":3,"sources":["C:/ws/graph-drill/src/state/vis/nodeSize.ts"],"names":["ROOT_COMMUNITY_ID","communityNodesTableState","getDefaultNumericOptions","useCallback","atom","atomFamily","selectorFamily","useRecoilValue","useSetRecoilState","getColumnStats","fieldState","key","default","encodingState","get","field","pid","table","stats","getDefaultNodeSizeOptions","useNodeSizeEncoding","useUpdateNodeSizeEncoding","encoding","setter","fieldSetter","update","value","domain","range"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA,SAASA,iBAAT,QAAkC,iBAAlC;AACA,SAASC,wBAAT,QAAyC,WAAzC;AACA,SAASC,wBAAT,QAAyC,UAAzC;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,SAASC,IAAT,EAAeC,UAAf,EAA2BC,cAA3B,EAA2CC,cAA3C,EAA2DC,iBAA3D,QAAqF,QAArF;AACA,SAASC,cAAT,QAA+B,WAA/B;AACA,OAAO,MAAMC,UAAU,GAAGN,IAAI,CAAC;AAC3BO,EAAAA,GAAG,EAAE,0BADsB;AAE3BC,EAAAA,OAAO,EAAE;AAFkB,CAAD,CAAvB;AAIP,MAAMC,aAAa,GAAGR,UAAU,CAAC;AAC7BM,EAAAA,GAAG,EAAE,0BADwB;AAE7BC,EAAAA,OAAO,EAAEN,cAAc,CAAC;AACpBK,IAAAA,GAAG,EAAE,kCADe;AAEpBG,IAAAA,GAAG,EAAGC,KAAD,IAAW,CAAC;AAAED,MAAAA;AAAF,KAAD,KAAa;AACzB;AACA,YAAME,GAAG,GAAGhB,iBAAZ;AACA,YAAMiB,KAAK,GAAGH,GAAG,CAACb,wBAAwB,CAACe,GAAD,CAAzB,CAAjB;AACA,YAAME,KAAK,GAAGT,cAAc,CAACQ,KAAD,EAAQF,KAAR,CAA5B;AACA,aAAOI,yBAAyB,CAACJ,KAAD,EAAQG,KAAR,CAAhC;AACH;AARmB,GAAD;AAFM,CAAD,CAAhC;AAaA,OAAO,SAASE,mBAAT,GAA+B;AAClC,QAAML,KAAK,GAAGR,cAAc,CAACG,UAAD,CAA5B;AACA,SAAOH,cAAc,CAACM,aAAa,CAACE,KAAD,CAAd,CAArB;AACH;AACD,OAAO,SAASM,yBAAT,GAAqC;AACxC,QAAMC,QAAQ,GAAGF,mBAAmB,EAApC;AACA,QAAMG,MAAM,GAAGf,iBAAiB,CAACK,aAAa,CAACS,QAAQ,CAACP,KAAT,IAAkB,EAAnB,CAAd,CAAhC;AACA,QAAMS,WAAW,GAAGhB,iBAAiB,CAACE,UAAD,CAArC;AACA,SAAOP,WAAW,CAAEsB,MAAD,IAAY;AAC3B,QAAIA,MAAM,CAACV,KAAX,EAAkB;AACdS,MAAAA,WAAW,CAACC,MAAM,CAACV,KAAR,CAAX;AACH,KAFD,MAGK;AACDQ,MAAAA,MAAM,iCACCD,QADD,GAECG,MAFD,EAAN;AAIH;AACJ,GAViB,EAUf,CAACH,QAAD,EAAWC,MAAX,EAAmBC,WAAnB,CAVe,CAAlB;AAWH;;AACD,SAASL,yBAAT,CAAmCJ,KAAnC,EAA0CG,KAA1C,EAAiD;AAC7C;AACA;AACA;AACA;AACA,SAAOhB,wBAAwB,CAACa,KAAD,EAAQG,KAAR,EAAe;AAC1CQ,IAAAA,KAAK,EAAE,CADmC;AAE1CC,IAAAA,MAAM,EAAET,KAAK,CAACS,MAF4B;AAG1CC,IAAAA,KAAK,EAAE,CAAC,GAAD,EAAM,EAAN;AAHmC,GAAf,CAA/B;AAKH","sourcesContent":["/*!\r\n * Copyright (c) Microsoft. All rights reserved.\r\n * Licensed under the MIT license. See LICENSE file in the project.\r\n */\r\nimport { ROOT_COMMUNITY_ID } from '../../constants';\r\nimport { communityNodesTableState } from '../tables';\r\nimport { getDefaultNumericOptions } from './config';\r\nimport { useCallback } from 'react';\r\nimport { atom, atomFamily, selectorFamily, useRecoilValue, useSetRecoilState, } from 'recoil';\r\nimport { getColumnStats } from '~/arquero';\r\nexport const fieldState = atom({\r\n    key: 'node-size-encoding-field',\r\n    default: 'node.d',\r\n});\r\nconst encodingState = atomFamily({\r\n    key: 'node-size-encoding-state',\r\n    default: selectorFamily({\r\n        key: 'node-size-encoding-state-default',\r\n        get: (field) => ({ get }) => {\r\n            // always use the root for size, which has the unique node list\r\n            const pid = ROOT_COMMUNITY_ID;\r\n            const table = get(communityNodesTableState(pid));\r\n            const stats = getColumnStats(table, field);\r\n            return getDefaultNodeSizeOptions(field, stats);\r\n        },\r\n    }),\r\n});\r\nexport function useNodeSizeEncoding() {\r\n    const field = useRecoilValue(fieldState);\r\n    return useRecoilValue(encodingState(field));\r\n}\r\nexport function useUpdateNodeSizeEncoding() {\r\n    const encoding = useNodeSizeEncoding();\r\n    const setter = useSetRecoilState(encodingState(encoding.field || ''));\r\n    const fieldSetter = useSetRecoilState(fieldState);\r\n    return useCallback((update) => {\r\n        if (update.field) {\r\n            fieldSetter(update.field);\r\n        }\r\n        else {\r\n            setter({\r\n                ...encoding,\r\n                ...update,\r\n            });\r\n        }\r\n    }, [encoding, setter, fieldSetter]);\r\n}\r\nfunction getDefaultNodeSizeOptions(field, stats) {\r\n    // TODO: most fields use the 99th quantile, but node.d/size is\r\n    // very particular from our data science team, and represents\r\n    // a specific range in order for no-overlap layouts to look correct\r\n    // maybe we can do a domain check and use a special case for these?\r\n    return getDefaultNumericOptions(field, stats, {\r\n        value: 4,\r\n        domain: stats.domain,\r\n        range: [0.5, 15],\r\n    });\r\n}\r\n"]}]}