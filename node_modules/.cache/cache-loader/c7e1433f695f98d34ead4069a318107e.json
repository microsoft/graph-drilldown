{"remainingRequest":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\babel-loader-virtual-fd8dd261de\\0\\cache\\babel-loader-npm-8.2.2-b4e600c2c5-df5092ef98.zip\\node_modules\\babel-loader\\lib\\index.js??ruleSet[1].rules[0].use[1]!C:\\ws\\graph-drill\\.yarn\\__virtual__\\ts-loader-virtual-aa0d54d245\\0\\cache\\ts-loader-npm-9.2.1-40e1a5908e-1f2e61905d.zip\\node_modules\\ts-loader\\index.js??ruleSet[1].rules[0].use[2]!C:\\ws\\graph-drill\\src\\controls\\DomainBrush\\Sparkbar.tsx","dependencies":[{"path":"C:\\ws\\graph-drill\\src\\controls\\DomainBrush\\Sparkbar.tsx","mtime":1631034960474},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\cache-loader-virtual-2fd14a2267\\0\\cache\\cache-loader-npm-4.1.0-82c3da90d8-0339778bdd.zip\\node_modules\\cache-loader\\dist\\cjs.js","mtime":456789000000},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\babel-loader-virtual-fd8dd261de\\0\\cache\\babel-loader-npm-8.2.2-b4e600c2c5-df5092ef98.zip\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\ts-loader-virtual-aa0d54d245\\0\\cache\\ts-loader-npm-9.2.1-40e1a5908e-1f2e61905d.zip\\node_modules\\ts-loader\\index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyohDQogKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4gU2VlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcHJvamVjdC4NCiAqLwppbXBvcnQgeyBTZWxlY3Rpb25TdGF0ZSB9IGZyb20gJ0B0aGVtYXRpYy9jb3JlJzsKaW1wb3J0IHsgcmVjdCwgbGluZSwgc3ZnIH0gZnJvbSAnQHRoZW1hdGljL2QzJzsKaW1wb3J0IHsgdXNlVGhlbWF0aWMgfSBmcm9tICdAdGhlbWF0aWMvcmVhY3QnOwppbXBvcnQgeyBicnVzaFggfSBmcm9tICdkMy1icnVzaCc7CmltcG9ydCB7IHNjYWxlTGluZWFyIH0gZnJvbSAnZDMtc2NhbGUnOwppbXBvcnQgeyBzZWxlY3QgfSBmcm9tICdkMy1zZWxlY3Rpb24nOwppbXBvcnQgUmVhY3QsIHsgbWVtbywgdXNlQ2FsbGJhY2ssIHVzZUxheW91dEVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSwgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7CmV4cG9ydCBjb25zdCBTcGFya2JhciA9IG1lbW8oZnVuY3Rpb24gU3BhcmtiYXIoewogIGRhdGEsCiAgZG9tYWluLAogIGJydXNoZWREb21haW4sCiAgd2lkdGgsCiAgaGVpZ2h0LAogIGJhcldpZHRoID0gOCwKICBiYXJHYXAgPSAxLAogIG5vZGF0YSwKICBzZWxlY3RlZCwKICBvbkNsaWNrLAogIHgsCiAgeSwKICBtYXJrZWQsCiAgb25CcnVzaEVuZAp9KSB7CiAgY29uc3QgeExpbmVhciA9IHVzZU1lbW8oKCkgPT4gc2NhbGVMaW5lYXIoKS5kb21haW4oZG9tYWluKS5yYW5nZShbYmFyV2lkdGggLyAyLCB3aWR0aCAtIGJhcldpZHRoIC8gMl0pLmNsYW1wKHRydWUpLCBbZG9tYWluLCB3aWR0aCwgYmFyV2lkdGhdKTsKICBjb25zdCB4U2NhbGUgPSB1c2VNZW1vKCgpID0+IChkLCBpKSA9PiB4TGluZWFyKHgoZCwgaSkpLCBbeCwgeExpbmVhcl0pOwogIGNvbnN0IGhTY2FsZSA9IHVzZU1lbW8oKCkgPT4gewogICAgY29uc3QgZXh0ID0gZ2V0RXh0ZW50KGRhdGEsIHkpOwogICAgY29uc3QgaCA9IHNjYWxlTGluZWFyKCkuZG9tYWluKGV4dCkucmFuZ2UoWzAsIGhlaWdodF0pOwogICAgcmV0dXJuIChkLCBpKSA9PiBoKGQubGVuZ3RoKTsKICB9LCBbZGF0YSwgeSwgaGVpZ2h0XSk7CiAgY29uc3QgdGhlbWUgPSB1c2VUaGVtYXRpYygpOwogIGNvbnN0IHJlZiA9IHVzZVJlZihudWxsKTsKICBjb25zdCBoYW5kbGVDbGljayA9IHVzZUNhbGxiYWNrKGQgPT4gb25DbGljayAmJiBvbkNsaWNrKGQpLCBbb25DbGlja10pOwogIGNvbnN0IG5vZGF0YUZuID0gdXNlQ2FsbGJhY2soZCA9PiB7CiAgICBpZiAobm9kYXRhKSB7CiAgICAgIHJldHVybiBub2RhdGEoZCk7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0sIFtub2RhdGFdKTsKICBjb25zdCBbaG92ZXJlZCwgc2V0SG92ZXJlZF0gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBoYW5kbGVIb3ZlciA9IHVzZUNhbGxiYWNrKGQgPT4gc2V0SG92ZXJlZChkKSwgW10pOwogIGNvbnN0IFtiYXJHcm91cCwgc2V0QmFyR3JvdXBdID0gdXNlU3RhdGUoKTsKICBjb25zdCBbYnJ1c2hTZWxlY3Rpb24sIHNldEJydXNoU2VsZWN0aW9uXSA9IHVzZVN0YXRlKCk7CiAgY29uc3QgaGFuZGxlQnJ1c2hFbmQgPSB1c2VDYWxsYmFjayhldmVudCA9PiB7CiAgICBpZiAob25CcnVzaEVuZCkgewogICAgICBpZiAoZXZlbnQgIT09IG51bGwgJiYgZXZlbnQgIT09IHZvaWQgMCAmJiBldmVudC5zb3VyY2VFdmVudCkgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHNlbGVjdGlvbgogICAgICAgIH0gPSBldmVudDsKICAgICAgICBjb25zdCBuZXdkb21haW4gPSBbeExpbmVhci5pbnZlcnQoc2VsZWN0aW9uWzBdKSwgeExpbmVhci5pbnZlcnQoc2VsZWN0aW9uWzFdKV07CiAgICAgICAgb25CcnVzaEVuZChuZXdkb21haW4pOwogICAgICB9CiAgICB9CiAgfSwgW29uQnJ1c2hFbmQsIHhMaW5lYXJdKTsKICBjb25zdCBicnVzaCA9IHVzZU1lbW8oKCkgPT4gYnJ1c2hYKCkub24oJ2VuZCcsIGhhbmRsZUJydXNoRW5kKSwgW2hhbmRsZUJydXNoRW5kXSk7CiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgIC8vIFRPRE86IHN0YWdlIHRoaXMgc28gaXQgZG9lc24ndCByZXNldCwgYnV0IHJhdGhlciB1cGRhdGVzCiAgICBzZWxlY3QocmVmLmN1cnJlbnQpLnNlbGVjdEFsbCgnc3ZnJykucmVtb3ZlKCk7CiAgICBjb25zdCBwbG90ID0gc2VsZWN0KHJlZi5jdXJyZW50KS5hcHBlbmQoJ3N2ZycpLmF0dHIoJ2NsYXNzJywgJ3NwYXJrYmFyLWNoYXJ0JykuYXR0cignd2lkdGgnLCB3aWR0aCkuYXR0cignaGVpZ2h0JywgaGVpZ2h0KS5jYWxsKHN2ZywgdGhlbWUuY2hhcnQoKSkuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnc3BhcmtiYXItcGxvdGFyZWEnKTsKICAgIHBsb3QuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCB3aWR0aCkuYXR0cignaGVpZ2h0JywgaGVpZ2h0KS5jYWxsKHJlY3QsIHRoZW1lLnBsb3RBcmVhKCkpOwogICAgY29uc3QgYmcgPSBwbG90LmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3NwYXJrYmFyLWJhcnMnKTsKICAgIHNldEJhckdyb3VwKGJnKTsgLy8gb25seSBhY3R1YWxseSBhcHBlbmQgdGhlIGJydXNoIGludGVyYWN0aW9uIGlmIHRoZXJlIGlzIGFuIGV2ZW50IHRvIGhhbmRsZSBpdAoKICAgIGlmIChvbkJydXNoRW5kKSB7CiAgICAgIGNvbnN0IGIgPSBwbG90LmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2JydXNoJykuY2FsbChicnVzaCk7CiAgICAgIGIuc2VsZWN0KCcuc2VsZWN0aW9uJykuYXR0cignc3Ryb2tlJywgJ25vbmUnKTsKICAgICAgc2V0QnJ1c2hTZWxlY3Rpb24oYik7CiAgICB9CiAgfSwgW3RoZW1lLCBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBicnVzaCwgb25CcnVzaEVuZF0pOwogIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IHlTY2FsZSA9IChkLCBpKSA9PiBoZWlnaHQgLSAoaFNjYWxlKGQsIGkpIHx8IDApOwoKICAgICAgaWYgKGJhckdyb3VwKSB7CiAgICAgICAgYmFyR3JvdXAuc2VsZWN0QWxsKCcqJykucmVtb3ZlKCk7CiAgICAgICAgYmFyR3JvdXAuc2VsZWN0QWxsKCcuYmFyJykuZGF0YShkYXRhKS5lbnRlcigpLmFwcGVuZCgnbGluZScpLmF0dHIoJ2NsYXNzJywgJ2JhcicpLmF0dHIoJ3gxJywgeFNjYWxlKS5hdHRyKCd4MicsIHhTY2FsZSkuYXR0cigneTEnLCB5U2NhbGUpLmF0dHIoJ3kyJywgaGVpZ2h0KS5jYWxsKGxpbmUsIHRoZW1lLmxpbmUoKSkuYXR0cignc3Ryb2tlLXdpZHRoJywgYmFyV2lkdGgpOwogICAgICB9CiAgICB9CiAgfSwgW3RoZW1lLCBkYXRhLCBiYXJHcm91cCwgd2lkdGgsIGhlaWdodCwgYmFyV2lkdGgsIGJhckdhcCwgbm9kYXRhRm4sIHhTY2FsZSwgaFNjYWxlXSk7CiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgIGlmIChiYXJHcm91cCkgewogICAgICBiYXJHcm91cC5zZWxlY3RBbGwoJy5iYXInKS5vbignbW91c2VvdmVyJywgZCA9PiBoYW5kbGVIb3ZlcihkKSkub24oJ21vdXNlb3V0JywgKCkgPT4gaGFuZGxlSG92ZXIobnVsbCkpLm9uKCdjbGljaycsIGhhbmRsZUNsaWNrKTsKICAgIH0KICB9LCBbZGF0YSwgYmFyR3JvdXAsIGhhbmRsZUNsaWNrLCBoYW5kbGVIb3Zlcl0pOwogIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICBjb25zdCBjdXJzb3IgPSBvbkNsaWNrID8gJ3BvaW50ZXInIDogJ2RlZmF1bHQnOwoKICAgIGlmIChiYXJHcm91cCkgewogICAgICBiYXJHcm91cC5zZWxlY3RBbGwoJy5iYXInKS5zdHlsZSgnY3Vyc29yJywgY3Vyc29yKTsKICAgIH0KICB9LCBbZGF0YSwgYmFyR3JvdXAsIG9uQ2xpY2tdKTsgLy8gZ2VuZXJhdGUgYSBjb21wbGltZW50YXJ5IGhpZ2hsaWdodAoKICBjb25zdCBoaWdobGlnaHQgPSB1c2VNZW1vKCgpID0+IHRoZW1lLnNjYWxlcygpLm5vbWluYWwoMTApKDEpLmhleCgpLCBbdGhlbWVdKTsKICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgY29uc3QgZ2V0U2VsZWN0aW9uU3RhdGUgPSBkID0+IHsKICAgICAgaWYgKG5vZGF0YUZuKGQpKSB7CiAgICAgICAgcmV0dXJuIFNlbGVjdGlvblN0YXRlLk5vRGF0YTsKICAgICAgfQoKICAgICAgaWYgKGQgPT09IGhvdmVyZWQpIHsKICAgICAgICByZXR1cm4gU2VsZWN0aW9uU3RhdGUuSG92ZXJlZDsKICAgICAgfQoKICAgICAgY29uc3Qgc2VsID0gc2VsZWN0ZWQgPyBzZWxlY3RlZChkKSA6IGZhbHNlOwoKICAgICAgaWYgKHNlbCkgewogICAgICAgIHJldHVybiBTZWxlY3Rpb25TdGF0ZS5TZWxlY3RlZDsKICAgICAgfQoKICAgICAgcmV0dXJuIFNlbGVjdGlvblN0YXRlLk5vcm1hbDsKICAgIH07CgogICAgaWYgKGJhckdyb3VwKSB7CiAgICAgIGJhckdyb3VwLnNlbGVjdEFsbCgnLmJhcicpLmF0dHIoJ3N0cm9rZScsIGQgPT4gewogICAgICAgIGNvbnN0IHNlbGVjdGlvblN0YXRlID0gZ2V0U2VsZWN0aW9uU3RhdGUoZCk7CiAgICAgICAgY29uc3QgbWFyayA9IG1hcmtlZCA/IG1hcmtlZChkKSA6IGZhbHNlOwogICAgICAgIHJldHVybiBtYXJrID8gaGlnaGxpZ2h0IDogdGhlbWUubGluZSh7CiAgICAgICAgICBzZWxlY3Rpb25TdGF0ZQogICAgICAgIH0pLnN0cm9rZSgpLmhleCgpOwogICAgICB9KTsKICAgIH0KICB9LCBbdGhlbWUsIGRhdGEsIGJhckdyb3VwLCBoaWdobGlnaHQsIG5vZGF0YUZuLCBob3ZlcmVkLCBzZWxlY3RlZCwgbWFya2VkXSk7CiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgIGlmIChicnVzaGVkRG9tYWluICYmIGJydXNoU2VsZWN0aW9uICYmIGJydXNoKSB7CiAgICAgIGlmIChicnVzaGVkRG9tYWluWzBdID09PSBkb21haW5bMF0gJiYgYnJ1c2hlZERvbWFpblsxXSA9PT0gZG9tYWluWzFdKSB7CiAgICAgICAgLy8gQ2xlYXIgb3V0IGJydXNoIHdoZW4gZGF0ZSByYW5nZSBpcyBtYXhlZCBvdXQuCiAgICAgICAgYnJ1c2gubW92ZShicnVzaFNlbGVjdGlvbiwgbnVsbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgW3N0YXJ0LCBlbmRdID0gYnJ1c2hlZERvbWFpbjsKICAgICAgICBicnVzaC5tb3ZlKGJydXNoU2VsZWN0aW9uLCBbeExpbmVhcihzdGFydCkgfHwgMCwgeExpbmVhcihlbmQpIHx8IDFdKTsKICAgICAgfQogICAgfQogIH0sIFticnVzaGVkRG9tYWluLCBkb21haW4sIHhMaW5lYXIsIGJydXNoLCBicnVzaFNlbGVjdGlvbl0pOwogIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KENvbnRhaW5lciwgewogICAgcmVmOiByZWYsCiAgICB3aWR0aDogd2lkdGgsCiAgICBoZWlnaHQ6IGhlaWdodAogIH0pOwp9KTsKCmZ1bmN0aW9uIGdldEV4dGVudChkYXRhLCBhY2Nlc3NvcikgewogIHJldHVybiBkYXRhLnJlZHVjZSgoYWNjLCBjdXIsIGlkeCkgPT4gewogICAgcmV0dXJuIFtNYXRoLm1pbihhY2Nlc3NvcihjdXIsIGlkeCksIGFjY1swXSksIE1hdGgubWF4KGFjY2Vzc29yKGN1ciwgaWR4KSwgYWNjWzFdKV07CiAgfSwgW051bWJlci5NQVhfVkFMVUUsIE51bWJlci5NSU5fVkFMVUVdKTsKfQoKY29uc3QgQ29udGFpbmVyID0gc3R5bGVkLmRpdmAKCXdpZHRoOiAkeyh7CiAgd2lkdGgKfSkgPT4gd2lkdGh9cHg7CgloZWlnaHQ6ICR7KHsKICBoZWlnaHQKfSkgPT4gaGVpZ2h0fXB4OwpgOw=="},{"version":3,"sources":["C:/ws/graph-drill/src/controls/DomainBrush/Sparkbar.tsx"],"names":["SelectionState","rect","line","svg","useThematic","brushX","scaleLinear","select","React","memo","useCallback","useLayoutEffect","useRef","useState","useMemo","styled","Sparkbar","data","domain","brushedDomain","width","height","barWidth","barGap","nodata","selected","onClick","x","y","marked","onBrushEnd","xLinear","range","clamp","xScale","d","i","hScale","ext","getExtent","h","length","theme","ref","handleClick","nodataFn","hovered","setHovered","handleHover","barGroup","setBarGroup","brushSelection","setBrushSelection","handleBrushEnd","event","sourceEvent","selection","newdomain","invert","brush","on","current","selectAll","remove","plot","append","attr","call","chart","plotArea","bg","b","yScale","enter","cursor","style","highlight","scales","nominal","hex","getSelectionState","NoData","Hovered","sel","Selected","Normal","selectionState","mark","stroke","move","start","end","createElement","Container","accessor","reduce","acc","cur","idx","Math","min","max","Number","MAX_VALUE","MIN_VALUE","div"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAASA,cAAT,QAA+B,gBAA/B;AACA,SAASC,IAAT,EAAeC,IAAf,EAAqBC,GAArB,QAAgC,cAAhC;AACA,SAASC,WAAT,QAA4B,iBAA5B;AACA,SAASC,MAAT,QAAuB,UAAvB;AACA,SAASC,WAAT,QAA4B,UAA5B;AACA,SAASC,MAAT,QAAuB,cAAvB;AACA,OAAOC,KAAP,IAAgBC,IAAhB,EAAsBC,WAAtB,EAAmCC,eAAnC,EAAoDC,MAApD,EAA4DC,QAA5D,EAAsEC,OAAtE,QAAsF,OAAtF;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,OAAO,MAAMC,QAAQ,GAAGP,IAAI,CAAC,SAASO,QAAT,CAAkB;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,MAAR;AAAgBC,EAAAA,aAAhB;AAA+BC,EAAAA,KAA/B;AAAsCC,EAAAA,MAAtC;AAA8CC,EAAAA,QAAQ,GAAG,CAAzD;AAA4DC,EAAAA,MAAM,GAAG,CAArE;AAAwEC,EAAAA,MAAxE;AAAgFC,EAAAA,QAAhF;AAA0FC,EAAAA,OAA1F;AAAmGC,EAAAA,CAAnG;AAAsGC,EAAAA,CAAtG;AAAyGC,EAAAA,MAAzG;AAAiHC,EAAAA;AAAjH,CAAlB,EAAkJ;AAC3K,QAAMC,OAAO,GAAGjB,OAAO,CAAC,MAAMR,WAAW,GACpCY,MADyB,CAClBA,MADkB,EAEzBc,KAFyB,CAEnB,CAACV,QAAQ,GAAG,CAAZ,EAAeF,KAAK,GAAGE,QAAQ,GAAG,CAAlC,CAFmB,EAGzBW,KAHyB,CAGnB,IAHmB,CAAP,EAGL,CAACf,MAAD,EAASE,KAAT,EAAgBE,QAAhB,CAHK,CAAvB;AAIA,QAAMY,MAAM,GAAGpB,OAAO,CAAC,MAAM,CAACqB,CAAD,EAAIC,CAAJ,KAAUL,OAAO,CAACJ,CAAC,CAACQ,CAAD,EAAIC,CAAJ,CAAF,CAAxB,EAAmC,CAACT,CAAD,EAAII,OAAJ,CAAnC,CAAtB;AACA,QAAMM,MAAM,GAAGvB,OAAO,CAAC,MAAM;AACzB,UAAMwB,GAAG,GAAGC,SAAS,CAACtB,IAAD,EAAOW,CAAP,CAArB;AACA,UAAMY,CAAC,GAAGlC,WAAW,GAAGY,MAAd,CAAqBoB,GAArB,EAA0BN,KAA1B,CAAgC,CAAC,CAAD,EAAIX,MAAJ,CAAhC,CAAV;AACA,WAAO,CAACc,CAAD,EAAIC,CAAJ,KAAUI,CAAC,CAACL,CAAC,CAACM,MAAH,CAAlB;AACH,GAJqB,EAInB,CAACxB,IAAD,EAAOW,CAAP,EAAUP,MAAV,CAJmB,CAAtB;AAKA,QAAMqB,KAAK,GAAGtC,WAAW,EAAzB;AACA,QAAMuC,GAAG,GAAG/B,MAAM,CAAC,IAAD,CAAlB;AACA,QAAMgC,WAAW,GAAGlC,WAAW,CAACyB,CAAC,IAAIT,OAAO,IAAIA,OAAO,CAACS,CAAD,CAAxB,EAA6B,CAACT,OAAD,CAA7B,CAA/B;AACA,QAAMmB,QAAQ,GAAGnC,WAAW,CAAEyB,CAAD,IAAO;AAChC,QAAIX,MAAJ,EAAY;AACR,aAAOA,MAAM,CAACW,CAAD,CAAb;AACH;;AACD,WAAO,KAAP;AACH,GAL2B,EAKzB,CAACX,MAAD,CALyB,CAA5B;AAMA,QAAM,CAACsB,OAAD,EAAUC,UAAV,IAAwBlC,QAAQ,CAAC,IAAD,CAAtC;AACA,QAAMmC,WAAW,GAAGtC,WAAW,CAACyB,CAAC,IAAIY,UAAU,CAACZ,CAAD,CAAhB,EAAqB,EAArB,CAA/B;AACA,QAAM,CAACc,QAAD,EAAWC,WAAX,IAA0BrC,QAAQ,EAAxC;AACA,QAAM,CAACsC,cAAD,EAAiBC,iBAAjB,IAAsCvC,QAAQ,EAApD;AACA,QAAMwC,cAAc,GAAG3C,WAAW,CAAC4C,KAAK,IAAI;AACxC,QAAIxB,UAAJ,EAAgB;AACZ,UAAIwB,KAAJ,aAAIA,KAAJ,eAAIA,KAAK,CAAEC,WAAX,EAAwB;AACpB,cAAM;AAAEC,UAAAA;AAAF,YAAgBF,KAAtB;AACA,cAAMG,SAAS,GAAG,CACd1B,OAAO,CAAC2B,MAAR,CAAeF,SAAS,CAAC,CAAD,CAAxB,CADc,EAEdzB,OAAO,CAAC2B,MAAR,CAAeF,SAAS,CAAC,CAAD,CAAxB,CAFc,CAAlB;AAIA1B,QAAAA,UAAU,CAAC2B,SAAD,CAAV;AACH;AACJ;AACJ,GAXiC,EAW/B,CAAC3B,UAAD,EAAaC,OAAb,CAX+B,CAAlC;AAYA,QAAM4B,KAAK,GAAG7C,OAAO,CAAC,MAAMT,MAAM,GAAGuD,EAAT,CAAY,KAAZ,EAAmBP,cAAnB,CAAP,EAA2C,CAACA,cAAD,CAA3C,CAArB;AACA1C,EAAAA,eAAe,CAAC,MAAM;AAClB;AACAJ,IAAAA,MAAM,CAACoC,GAAG,CAACkB,OAAL,CAAN,CAAoBC,SAApB,CAA8B,KAA9B,EAAqCC,MAArC;AACA,UAAMC,IAAI,GAAGzD,MAAM,CAACoC,GAAG,CAACkB,OAAL,CAAN,CACRI,MADQ,CACD,KADC,EAERC,IAFQ,CAEH,OAFG,EAEM,gBAFN,EAGRA,IAHQ,CAGH,OAHG,EAGM9C,KAHN,EAIR8C,IAJQ,CAIH,QAJG,EAIO7C,MAJP,EAKR8C,IALQ,CAKHhE,GALG,EAKEuC,KAAK,CAAC0B,KAAN,EALF,EAMRH,MANQ,CAMD,GANC,EAORC,IAPQ,CAOH,OAPG,EAOM,mBAPN,CAAb;AAQAF,IAAAA,IAAI,CACCC,MADL,CACY,MADZ,EAEKC,IAFL,CAEU,OAFV,EAEmB9C,KAFnB,EAGK8C,IAHL,CAGU,QAHV,EAGoB7C,MAHpB,EAIK8C,IAJL,CAIUlE,IAJV,EAIgByC,KAAK,CAAC2B,QAAN,EAJhB;AAKA,UAAMC,EAAE,GAAGN,IAAI,CAACC,MAAL,CAAY,GAAZ,EAAiBC,IAAjB,CAAsB,OAAtB,EAA+B,eAA/B,CAAX;AACAhB,IAAAA,WAAW,CAACoB,EAAD,CAAX,CAjBkB,CAkBlB;;AACA,QAAIxC,UAAJ,EAAgB;AACZ,YAAMyC,CAAC,GAAGP,IAAI,CAACC,MAAL,CAAY,GAAZ,EAAiBC,IAAjB,CAAsB,OAAtB,EAA+B,OAA/B,EAAwCC,IAAxC,CAA6CR,KAA7C,CAAV;AACAY,MAAAA,CAAC,CAAChE,MAAF,CAAS,YAAT,EAAuB2D,IAAvB,CAA4B,QAA5B,EAAsC,MAAtC;AACAd,MAAAA,iBAAiB,CAACmB,CAAD,CAAjB;AACH;AACJ,GAxBc,EAwBZ,CAAC7B,KAAD,EAAQzB,IAAR,EAAcG,KAAd,EAAqBC,MAArB,EAA6BsC,KAA7B,EAAoC7B,UAApC,CAxBY,CAAf;AAyBAnB,EAAAA,eAAe,CAAC,MAAM;AAClB,QAAIM,IAAI,CAACwB,MAAL,GAAc,CAAlB,EAAqB;AACjB,YAAM+B,MAAM,GAAG,CAACrC,CAAD,EAAIC,CAAJ,KAAUf,MAAM,IAAIgB,MAAM,CAACF,CAAD,EAAIC,CAAJ,CAAN,IAAgB,CAApB,CAA/B;;AACA,UAAIa,QAAJ,EAAc;AACVA,QAAAA,QAAQ,CAACa,SAAT,CAAmB,GAAnB,EAAwBC,MAAxB;AACAd,QAAAA,QAAQ,CACHa,SADL,CACe,MADf,EAEK7C,IAFL,CAEUA,IAFV,EAGKwD,KAHL,GAIKR,MAJL,CAIY,MAJZ,EAKKC,IALL,CAKU,OALV,EAKmB,KALnB,EAMKA,IANL,CAMU,IANV,EAMgBhC,MANhB,EAOKgC,IAPL,CAOU,IAPV,EAOgBhC,MAPhB,EAQKgC,IARL,CAQU,IARV,EAQgBM,MARhB,EASKN,IATL,CASU,IATV,EASgB7C,MAThB,EAUK8C,IAVL,CAUUjE,IAVV,EAUgBwC,KAAK,CAACxC,IAAN,EAVhB,EAWKgE,IAXL,CAWU,cAXV,EAW0B5C,QAX1B;AAYH;AACJ;AACJ,GAnBc,EAmBZ,CACCoB,KADD,EAECzB,IAFD,EAGCgC,QAHD,EAIC7B,KAJD,EAKCC,MALD,EAMCC,QAND,EAOCC,MAPD,EAQCsB,QARD,EASCX,MATD,EAUCG,MAVD,CAnBY,CAAf;AA+BA1B,EAAAA,eAAe,CAAC,MAAM;AAClB,QAAIsC,QAAJ,EAAc;AACVA,MAAAA,QAAQ,CACHa,SADL,CACe,MADf,EAEKF,EAFL,CAEQ,WAFR,EAEsBzB,CAAD,IAAOa,WAAW,CAACb,CAAD,CAFvC,EAGKyB,EAHL,CAGQ,UAHR,EAGoB,MAAMZ,WAAW,CAAC,IAAD,CAHrC,EAIKY,EAJL,CAIQ,OAJR,EAIiBhB,WAJjB;AAKH;AACJ,GARc,EAQZ,CAAC3B,IAAD,EAAOgC,QAAP,EAAiBL,WAAjB,EAA8BI,WAA9B,CARY,CAAf;AASArC,EAAAA,eAAe,CAAC,MAAM;AAClB,UAAM+D,MAAM,GAAGhD,OAAO,GAAG,SAAH,GAAe,SAArC;;AACA,QAAIuB,QAAJ,EAAc;AACVA,MAAAA,QAAQ,CAACa,SAAT,CAAmB,MAAnB,EAA2Ba,KAA3B,CAAiC,QAAjC,EAA2CD,MAA3C;AACH;AACJ,GALc,EAKZ,CAACzD,IAAD,EAAOgC,QAAP,EAAiBvB,OAAjB,CALY,CAAf,CAtG2K,CA4G3K;;AACA,QAAMkD,SAAS,GAAG9D,OAAO,CAAC,MAAM4B,KAAK,CAACmC,MAAN,GAAeC,OAAf,CAAuB,EAAvB,EAA2B,CAA3B,EAA8BC,GAA9B,EAAP,EAA4C,CAACrC,KAAD,CAA5C,CAAzB;AACA/B,EAAAA,eAAe,CAAC,MAAM;AAClB,UAAMqE,iBAAiB,GAAI7C,CAAD,IAAO;AAC7B,UAAIU,QAAQ,CAACV,CAAD,CAAZ,EAAiB;AACb,eAAOnC,cAAc,CAACiF,MAAtB;AACH;;AACD,UAAI9C,CAAC,KAAKW,OAAV,EAAmB;AACf,eAAO9C,cAAc,CAACkF,OAAtB;AACH;;AACD,YAAMC,GAAG,GAAG1D,QAAQ,GAAGA,QAAQ,CAACU,CAAD,CAAX,GAAiB,KAArC;;AACA,UAAIgD,GAAJ,EAAS;AACL,eAAOnF,cAAc,CAACoF,QAAtB;AACH;;AACD,aAAOpF,cAAc,CAACqF,MAAtB;AACH,KAZD;;AAaA,QAAIpC,QAAJ,EAAc;AACVA,MAAAA,QAAQ,CAACa,SAAT,CAAmB,MAAnB,EAA2BI,IAA3B,CAAgC,QAAhC,EAA2C/B,CAAD,IAAO;AAC7C,cAAMmD,cAAc,GAAGN,iBAAiB,CAAC7C,CAAD,CAAxC;AACA,cAAMoD,IAAI,GAAG1D,MAAM,GAAGA,MAAM,CAACM,CAAD,CAAT,GAAe,KAAlC;AACA,eAAOoD,IAAI,GACLX,SADK,GAELlC,KAAK,CACFxC,IADH,CACQ;AACNoF,UAAAA;AADM,SADR,EAIGE,MAJH,GAKGT,GALH,EAFN;AAQH,OAXD;AAYH;AACJ,GA5Bc,EA4BZ,CAACrC,KAAD,EAAQzB,IAAR,EAAcgC,QAAd,EAAwB2B,SAAxB,EAAmC/B,QAAnC,EAA6CC,OAA7C,EAAsDrB,QAAtD,EAAgEI,MAAhE,CA5BY,CAAf;AA6BAlB,EAAAA,eAAe,CAAC,MAAM;AAClB,QAAIQ,aAAa,IAAIgC,cAAjB,IAAmCQ,KAAvC,EAA8C;AAC1C,UAAIxC,aAAa,CAAC,CAAD,CAAb,KAAqBD,MAAM,CAAC,CAAD,CAA3B,IAAkCC,aAAa,CAAC,CAAD,CAAb,KAAqBD,MAAM,CAAC,CAAD,CAAjE,EAAsE;AAClE;AACAyC,QAAAA,KAAK,CAAC8B,IAAN,CAAWtC,cAAX,EAA2B,IAA3B;AACH,OAHD,MAIK;AACD,cAAM,CAACuC,KAAD,EAAQC,GAAR,IAAexE,aAArB;AACAwC,QAAAA,KAAK,CAAC8B,IAAN,CAAWtC,cAAX,EAA2B,CAACpB,OAAO,CAAC2D,KAAD,CAAP,IAAkB,CAAnB,EAAsB3D,OAAO,CAAC4D,GAAD,CAAP,IAAgB,CAAtC,CAA3B;AACH;AACJ;AACJ,GAXc,EAWZ,CAACxE,aAAD,EAAgBD,MAAhB,EAAwBa,OAAxB,EAAiC4B,KAAjC,EAAwCR,cAAxC,CAXY,CAAf;AAYA,SAAO3C,KAAK,CAACoF,aAAN,CAAoBC,SAApB,EAA+B;AAAElD,IAAAA,GAAG,EAAEA,GAAP;AAAYvB,IAAAA,KAAK,EAAEA,KAAnB;AAA0BC,IAAAA,MAAM,EAAEA;AAAlC,GAA/B,CAAP;AACH,CAxJ2B,CAArB;;AAyJP,SAASkB,SAAT,CAAmBtB,IAAnB,EAAyB6E,QAAzB,EAAmC;AAC/B,SAAO7E,IAAI,CAAC8E,MAAL,CAAY,CAACC,GAAD,EAAMC,GAAN,EAAWC,GAAX,KAAmB;AAClC,WAAO,CACHC,IAAI,CAACC,GAAL,CAASN,QAAQ,CAACG,GAAD,EAAMC,GAAN,CAAjB,EAA6BF,GAAG,CAAC,CAAD,CAAhC,CADG,EAEHG,IAAI,CAACE,GAAL,CAASP,QAAQ,CAACG,GAAD,EAAMC,GAAN,CAAjB,EAA6BF,GAAG,CAAC,CAAD,CAAhC,CAFG,CAAP;AAIH,GALM,EAKJ,CAACM,MAAM,CAACC,SAAR,EAAmBD,MAAM,CAACE,SAA1B,CALI,CAAP;AAMH;;AACD,MAAMX,SAAS,GAAG9E,MAAM,CAAC0F,GAAK;AAC9B,UAAU,CAAC;AAAErF,EAAAA;AAAF,CAAD,KAAeA,KAAM;AAC/B,WAAW,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAgBA,MAAO;AAClC,CAHA","sourcesContent":["/*!\r\n * Copyright (c) Microsoft. All rights reserved.\r\n * Licensed under the MIT license. See LICENSE file in the project.\r\n */\r\nimport { SelectionState } from '@thematic/core';\r\nimport { rect, line, svg } from '@thematic/d3';\r\nimport { useThematic } from '@thematic/react';\r\nimport { brushX } from 'd3-brush';\r\nimport { scaleLinear } from 'd3-scale';\r\nimport { select } from 'd3-selection';\r\nimport React, { memo, useCallback, useLayoutEffect, useRef, useState, useMemo, } from 'react';\r\nimport styled from 'styled-components';\r\nexport const Sparkbar = memo(function Sparkbar({ data, domain, brushedDomain, width, height, barWidth = 8, barGap = 1, nodata, selected, onClick, x, y, marked, onBrushEnd, }) {\r\n    const xLinear = useMemo(() => scaleLinear()\r\n        .domain(domain)\r\n        .range([barWidth / 2, width - barWidth / 2])\r\n        .clamp(true), [domain, width, barWidth]);\r\n    const xScale = useMemo(() => (d, i) => xLinear(x(d, i)), [x, xLinear]);\r\n    const hScale = useMemo(() => {\r\n        const ext = getExtent(data, y);\r\n        const h = scaleLinear().domain(ext).range([0, height]);\r\n        return (d, i) => h(d.length);\r\n    }, [data, y, height]);\r\n    const theme = useThematic();\r\n    const ref = useRef(null);\r\n    const handleClick = useCallback(d => onClick && onClick(d), [onClick]);\r\n    const nodataFn = useCallback((d) => {\r\n        if (nodata) {\r\n            return nodata(d);\r\n        }\r\n        return false;\r\n    }, [nodata]);\r\n    const [hovered, setHovered] = useState(null);\r\n    const handleHover = useCallback(d => setHovered(d), []);\r\n    const [barGroup, setBarGroup] = useState();\r\n    const [brushSelection, setBrushSelection] = useState();\r\n    const handleBrushEnd = useCallback(event => {\r\n        if (onBrushEnd) {\r\n            if (event?.sourceEvent) {\r\n                const { selection } = event;\r\n                const newdomain = [\r\n                    xLinear.invert(selection[0]),\r\n                    xLinear.invert(selection[1]),\r\n                ];\r\n                onBrushEnd(newdomain);\r\n            }\r\n        }\r\n    }, [onBrushEnd, xLinear]);\r\n    const brush = useMemo(() => brushX().on('end', handleBrushEnd), [handleBrushEnd]);\r\n    useLayoutEffect(() => {\r\n        // TODO: stage this so it doesn't reset, but rather updates\r\n        select(ref.current).selectAll('svg').remove();\r\n        const plot = select(ref.current)\r\n            .append('svg')\r\n            .attr('class', 'sparkbar-chart')\r\n            .attr('width', width)\r\n            .attr('height', height)\r\n            .call(svg, theme.chart())\r\n            .append('g')\r\n            .attr('class', 'sparkbar-plotarea');\r\n        plot\r\n            .append('rect')\r\n            .attr('width', width)\r\n            .attr('height', height)\r\n            .call(rect, theme.plotArea());\r\n        const bg = plot.append('g').attr('class', 'sparkbar-bars');\r\n        setBarGroup(bg);\r\n        // only actually append the brush interaction if there is an event to handle it\r\n        if (onBrushEnd) {\r\n            const b = plot.append('g').attr('class', 'brush').call(brush);\r\n            b.select('.selection').attr('stroke', 'none');\r\n            setBrushSelection(b);\r\n        }\r\n    }, [theme, data, width, height, brush, onBrushEnd]);\r\n    useLayoutEffect(() => {\r\n        if (data.length > 0) {\r\n            const yScale = (d, i) => height - (hScale(d, i) || 0);\r\n            if (barGroup) {\r\n                barGroup.selectAll('*').remove();\r\n                barGroup\r\n                    .selectAll('.bar')\r\n                    .data(data)\r\n                    .enter()\r\n                    .append('line')\r\n                    .attr('class', 'bar')\r\n                    .attr('x1', xScale)\r\n                    .attr('x2', xScale)\r\n                    .attr('y1', yScale)\r\n                    .attr('y2', height)\r\n                    .call(line, theme.line())\r\n                    .attr('stroke-width', barWidth);\r\n            }\r\n        }\r\n    }, [\r\n        theme,\r\n        data,\r\n        barGroup,\r\n        width,\r\n        height,\r\n        barWidth,\r\n        barGap,\r\n        nodataFn,\r\n        xScale,\r\n        hScale,\r\n    ]);\r\n    useLayoutEffect(() => {\r\n        if (barGroup) {\r\n            barGroup\r\n                .selectAll('.bar')\r\n                .on('mouseover', (d) => handleHover(d))\r\n                .on('mouseout', () => handleHover(null))\r\n                .on('click', handleClick);\r\n        }\r\n    }, [data, barGroup, handleClick, handleHover]);\r\n    useLayoutEffect(() => {\r\n        const cursor = onClick ? 'pointer' : 'default';\r\n        if (barGroup) {\r\n            barGroup.selectAll('.bar').style('cursor', cursor);\r\n        }\r\n    }, [data, barGroup, onClick]);\r\n    // generate a complimentary highlight\r\n    const highlight = useMemo(() => theme.scales().nominal(10)(1).hex(), [theme]);\r\n    useLayoutEffect(() => {\r\n        const getSelectionState = (d) => {\r\n            if (nodataFn(d)) {\r\n                return SelectionState.NoData;\r\n            }\r\n            if (d === hovered) {\r\n                return SelectionState.Hovered;\r\n            }\r\n            const sel = selected ? selected(d) : false;\r\n            if (sel) {\r\n                return SelectionState.Selected;\r\n            }\r\n            return SelectionState.Normal;\r\n        };\r\n        if (barGroup) {\r\n            barGroup.selectAll('.bar').attr('stroke', (d) => {\r\n                const selectionState = getSelectionState(d);\r\n                const mark = marked ? marked(d) : false;\r\n                return mark\r\n                    ? highlight\r\n                    : theme\r\n                        .line({\r\n                        selectionState,\r\n                    })\r\n                        .stroke()\r\n                        .hex();\r\n            });\r\n        }\r\n    }, [theme, data, barGroup, highlight, nodataFn, hovered, selected, marked]);\r\n    useLayoutEffect(() => {\r\n        if (brushedDomain && brushSelection && brush) {\r\n            if (brushedDomain[0] === domain[0] && brushedDomain[1] === domain[1]) {\r\n                // Clear out brush when date range is maxed out.\r\n                brush.move(brushSelection, null);\r\n            }\r\n            else {\r\n                const [start, end] = brushedDomain;\r\n                brush.move(brushSelection, [xLinear(start) || 0, xLinear(end) || 1]);\r\n            }\r\n        }\r\n    }, [brushedDomain, domain, xLinear, brush, brushSelection]);\r\n    return React.createElement(Container, { ref: ref, width: width, height: height });\r\n});\r\nfunction getExtent(data, accessor) {\r\n    return data.reduce((acc, cur, idx) => {\r\n        return [\r\n            Math.min(accessor(cur, idx), acc[0]),\r\n            Math.max(accessor(cur, idx), acc[1]),\r\n        ];\r\n    }, [Number.MAX_VALUE, Number.MIN_VALUE]);\r\n}\r\nconst Container = styled.div `\r\n\twidth: ${({ width }) => width}px;\r\n\theight: ${({ height }) => height}px;\r\n`;\r\n"]}]}