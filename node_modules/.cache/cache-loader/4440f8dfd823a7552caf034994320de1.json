{"remainingRequest":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\babel-loader-virtual-fd8dd261de\\0\\cache\\babel-loader-npm-8.2.2-b4e600c2c5-df5092ef98.zip\\node_modules\\babel-loader\\lib\\index.js??ruleSet[1].rules[0].use[1]!C:\\ws\\graph-drill\\.yarn\\__virtual__\\ts-loader-virtual-aa0d54d245\\0\\cache\\ts-loader-npm-9.2.1-40e1a5908e-1f2e61905d.zip\\node_modules\\ts-loader\\index.js??ruleSet[1].rules[0].use[2]!C:\\ws\\graph-drill\\src\\components\\App\\LazyCachingSwitch.tsx","dependencies":[{"path":"C:\\ws\\graph-drill\\src\\components\\App\\LazyCachingSwitch.tsx","mtime":1620403249141},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\cache-loader-virtual-2fd14a2267\\0\\cache\\cache-loader-npm-4.1.0-82c3da90d8-0339778bdd.zip\\node_modules\\cache-loader\\dist\\cjs.js","mtime":456789000000},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\babel-loader-virtual-fd8dd261de\\0\\cache\\babel-loader-npm-8.2.2-b4e600c2c5-df5092ef98.zip\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\ws\\graph-drill\\.yarn\\__virtual__\\ts-loader-virtual-aa0d54d245\\0\\cache\\ts-loader-npm-9.2.1-40e1a5908e-1f2e61905d.zip\\node_modules\\ts-loader\\index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgeyBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IH0ga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgovKiENCiAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0LiBBbGwgcmlnaHRzIHJlc2VydmVkLg0KICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLiBTZWUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0Lg0KICovCmltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnOwppbXBvcnQgeyB3aXRoUm91dGVyIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7Ci8qKg0KICogRXNzZW50aWFsbHkgcmVwbGljYXRlcyBhIHJlYWN0LXJvdXRlciBTd2l0Y2gsDQogKiBidXQgdXNlcyBhIHN0YXRlIGNhY2hlIHRvIGxhemlseSByZW5kZXIgY29tcG9uZW50cywNCiAqIGFuZCBoaWRlIHRoZW0gaWYgdGhleSBhcmVuJ3QgbWF0Y2hlZC4NCiAqIFRoaXMgYWxsb3dzIHVzIHRvIGF2b2lkIHRoZSBoZWF2eSBjb3N0IG9mIHJlbW91bnRpbmcNCiAqIGV4cGVuc2l2ZSBjb21wb25lbnRzIGFzIHRoZSB1c2VyIG5hdmlnYXRlcyB0aGUgYXBwLg0KICogV2FybmluZ3M6DQogKiAgMS4gVGhpcyB3aWxsIHByb2JhYmx5IHJlc3VsdCBpbiBoZWF2aWVyIG1lbW9yeSB1c2FnZQ0KICogIDIuIEl0IG9ubHkgc3VwcG9ydHMgUm91dGUsIG5vdCBSZWRpcmVjdCwgYW5kIG11c3QgdXNlIFJvdXRlLmNvbXBvbmVudCBwcm9wDQogKiAgMy4gSXQgb25seSBzdXBwb3J0cyBleGFjdCBtYXRjaGVzDQogKi8KCmV4cG9ydCBjb25zdCBMYXp5Q2FjaGluZ1N3aXRjaCA9IHdpdGhSb3V0ZXIoKHsKICBsb2NhdGlvbiwKICBjaGlsZHJlbgp9KSA9PiB7CiAgY29uc3QgW2NhY2hlLCBzZXRDYWNoZV0gPSB1c2VTdGF0ZSh7fSk7IC8vIGZpcnN0IGl0ZXJhdGlvbiBlbnN1cmVzIHdlJ3ZlIHJlbmRlcmVkIHRoZSBtYXRjaGVkIGNvbXBvbmVudCwgYW5kIHVwZGF0ZXMgdGhlIGNhY2hlIGFzIG5lY2Vzc2FyeQoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgY29uc3QgdXBkYXRlZCA9IF9vYmplY3RTcHJlYWQoe30sIGNhY2hlKTsKCiAgICBsZXQgaXNEaXJ0eSA9IGZhbHNlOyAvLyBmaXJzdCByb3V0ZSBtYXRjaCB3aW5zLCBtaW1pY2tpbmcgYmVoYXZpb3IgZnJvbSBTd2l0Y2gKCiAgICBsZXQgZm91bmRGaXJzdCA9IGZhbHNlOwogICAgUmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbiwgY2hpbGQgPT4gewogICAgICBpZiAoIWZvdW5kRmlyc3QgJiYgUmVhY3QuaXNWYWxpZEVsZW1lbnQoY2hpbGQpKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgcGF0aAogICAgICAgIH0gPSBjaGlsZC5wcm9wczsKICAgICAgICBjb25zdCBtYXRjaGVkID0gbG9jYXRpb24ucGF0aG5hbWUubWF0Y2goYF4ke3BhdGh9JGApOwoKICAgICAgICBpZiAobWF0Y2hlZCkgewogICAgICAgICAgZm91bmRGaXJzdCA9IHRydWU7CiAgICAgICAgICBsZXQgaW5zdGFuY2UgPSB1cGRhdGVkW3BhdGhdOwoKICAgICAgICAgIGlmICghaW5zdGFuY2UpIHsKICAgICAgICAgICAgaW5zdGFuY2UgPSBSZWFjdC5jcmVhdGVFbGVtZW50KGNoaWxkLnByb3BzLmNvbXBvbmVudCwgbnVsbCk7CiAgICAgICAgICAgIHVwZGF0ZWRbcGF0aF0gPSBpbnN0YW5jZTsKICAgICAgICAgICAgaXNEaXJ0eSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBpZiAoaXNEaXJ0eSkgewogICAgICBzZXRDYWNoZSh1cGRhdGVkKTsKICAgIH0KICB9LCBbY2FjaGUsIHNldENhY2hlLCBsb2NhdGlvbiwgY2hpbGRyZW5dKTsgLy8gc2Vjb25kIGl0ZXJhdGlvbiBjcmVhdGVzIGEgc2V0IG9mIHJlbmRlcmVkIGNvbXBvbmVudHMgZnJvbSB0aGUgY2FjaGUsIGhpZGRlbiBpZiBub3QgbWF0Y2hlZAoKICBjb25zdCByZW5kZXJlZCA9IHVzZU1lbW8oKCkgPT4gewogICAgcmV0dXJuIFJlYWN0LkNoaWxkcmVuLm1hcChjaGlsZHJlbiwgY2hpbGQgPT4gewogICAgICBpZiAoUmVhY3QuaXNWYWxpZEVsZW1lbnQoY2hpbGQpKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgcGF0aAogICAgICAgIH0gPSBjaGlsZC5wcm9wczsKICAgICAgICBjb25zdCBtYXRjaGVkID0gbG9jYXRpb24ucGF0aG5hbWUubWF0Y2goYF4ke3BhdGh9JGApOwogICAgICAgIGNvbnN0IHN0eWxlID0ge307CgogICAgICAgIGlmICghbWF0Y2hlZCkgewogICAgICAgICAgc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGluc3RhbmNlID0gY2FjaGVbcGF0aF07CiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgIHN0eWxlOiBzdHlsZSwKICAgICAgICAgIGtleTogcGF0aAogICAgICAgIH0sIGluc3RhbmNlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9KTsKICB9LCBbY2FjaGUsIGxvY2F0aW9uLCBjaGlsZHJlbl0pOwogIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCBudWxsLCByZW5kZXJlZCk7Cn0pOw=="},{"version":3,"sources":["C:/ws/graph-drill/src/components/App/LazyCachingSwitch.tsx"],"names":["React","useEffect","useMemo","useState","withRouter","LazyCachingSwitch","location","children","cache","setCache","updated","isDirty","foundFirst","Children","forEach","child","isValidElement","path","props","matched","pathname","match","instance","createElement","component","rendered","map","style","display","key","Fragment"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,OAA3B,EAAoCC,QAApC,QAAoD,OAApD;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMC,iBAAiB,GAAGD,UAAU,CAAC,CAAC;AAAEE,EAAAA,QAAF;AAAYC,EAAAA;AAAZ,CAAD,KAA4B;AACpE,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBN,QAAQ,CAAC,EAAD,CAAlC,CADoE,CAEpE;;AACAF,EAAAA,SAAS,CAAC,MAAM;AACZ,UAAMS,OAAO,qBAAQF,KAAR,CAAb;;AACA,QAAIG,OAAO,GAAG,KAAd,CAFY,CAGZ;;AACA,QAAIC,UAAU,GAAG,KAAjB;AACAZ,IAAAA,KAAK,CAACa,QAAN,CAAeC,OAAf,CAAuBP,QAAvB,EAAiCQ,KAAK,IAAI;AACtC,UAAI,CAACH,UAAD,IAAeZ,KAAK,CAACgB,cAAN,CAAqBD,KAArB,CAAnB,EAAgD;AAC5C,cAAM;AAAEE,UAAAA;AAAF,YAAWF,KAAK,CAACG,KAAvB;AACA,cAAMC,OAAO,GAAGb,QAAQ,CAACc,QAAT,CAAkBC,KAAlB,CAAyB,IAAGJ,IAAK,GAAjC,CAAhB;;AACA,YAAIE,OAAJ,EAAa;AACTP,UAAAA,UAAU,GAAG,IAAb;AACA,cAAIU,QAAQ,GAAGZ,OAAO,CAACO,IAAD,CAAtB;;AACA,cAAI,CAACK,QAAL,EAAe;AACXA,YAAAA,QAAQ,GAAGtB,KAAK,CAACuB,aAAN,CAAoBR,KAAK,CAACG,KAAN,CAAYM,SAAhC,EAA2C,IAA3C,CAAX;AACAd,YAAAA,OAAO,CAACO,IAAD,CAAP,GAAgBK,QAAhB;AACAX,YAAAA,OAAO,GAAG,IAAV;AACH;AACJ;AACJ;AACJ,KAdD;;AAeA,QAAIA,OAAJ,EAAa;AACTF,MAAAA,QAAQ,CAACC,OAAD,CAAR;AACH;AACJ,GAvBQ,EAuBN,CAACF,KAAD,EAAQC,QAAR,EAAkBH,QAAlB,EAA4BC,QAA5B,CAvBM,CAAT,CAHoE,CA2BpE;;AACA,QAAMkB,QAAQ,GAAGvB,OAAO,CAAC,MAAM;AAC3B,WAAOF,KAAK,CAACa,QAAN,CAAea,GAAf,CAAmBnB,QAAnB,EAA6BQ,KAAK,IAAI;AACzC,UAAIf,KAAK,CAACgB,cAAN,CAAqBD,KAArB,CAAJ,EAAiC;AAC7B,cAAM;AAAEE,UAAAA;AAAF,YAAWF,KAAK,CAACG,KAAvB;AACA,cAAMC,OAAO,GAAGb,QAAQ,CAACc,QAAT,CAAkBC,KAAlB,CAAyB,IAAGJ,IAAK,GAAjC,CAAhB;AACA,cAAMU,KAAK,GAAG,EAAd;;AACA,YAAI,CAACR,OAAL,EAAc;AACVQ,UAAAA,KAAK,CAACC,OAAN,GAAgB,MAAhB;AACH;;AACD,cAAMN,QAAQ,GAAGd,KAAK,CAACS,IAAD,CAAtB;AACA,eAAQjB,KAAK,CAACuB,aAAN,CAAoB,KAApB,EAA2B;AAAEI,UAAAA,KAAK,EAAEA,KAAT;AAAgBE,UAAAA,GAAG,EAAEZ;AAArB,SAA3B,EAAwDK,QAAxD,CAAR;AACH;;AACD,aAAO,IAAP;AACH,KAZM,CAAP;AAaH,GAduB,EAcrB,CAACd,KAAD,EAAQF,QAAR,EAAkBC,QAAlB,CAdqB,CAAxB;AAeA,SAAOP,KAAK,CAACuB,aAAN,CAAoBvB,KAAK,CAAC8B,QAA1B,EAAoC,IAApC,EAA0CL,QAA1C,CAAP;AACH,CA5C0C,CAApC","sourcesContent":["/*!\r\n * Copyright (c) Microsoft. All rights reserved.\r\n * Licensed under the MIT license. See LICENSE file in the project.\r\n */\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\n/**\r\n * Essentially replicates a react-router Switch,\r\n * but uses a state cache to lazily render components,\r\n * and hide them if they aren't matched.\r\n * This allows us to avoid the heavy cost of remounting\r\n * expensive components as the user navigates the app.\r\n * Warnings:\r\n *  1. This will probably result in heavier memory usage\r\n *  2. It only supports Route, not Redirect, and must use Route.component prop\r\n *  3. It only supports exact matches\r\n */\r\nexport const LazyCachingSwitch = withRouter(({ location, children }) => {\r\n    const [cache, setCache] = useState({});\r\n    // first iteration ensures we've rendered the matched component, and updates the cache as necessary\r\n    useEffect(() => {\r\n        const updated = { ...cache };\r\n        let isDirty = false;\r\n        // first route match wins, mimicking behavior from Switch\r\n        let foundFirst = false;\r\n        React.Children.forEach(children, child => {\r\n            if (!foundFirst && React.isValidElement(child)) {\r\n                const { path } = child.props;\r\n                const matched = location.pathname.match(`^${path}$`);\r\n                if (matched) {\r\n                    foundFirst = true;\r\n                    let instance = updated[path];\r\n                    if (!instance) {\r\n                        instance = React.createElement(child.props.component, null);\r\n                        updated[path] = instance;\r\n                        isDirty = true;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        if (isDirty) {\r\n            setCache(updated);\r\n        }\r\n    }, [cache, setCache, location, children]);\r\n    // second iteration creates a set of rendered components from the cache, hidden if not matched\r\n    const rendered = useMemo(() => {\r\n        return React.Children.map(children, child => {\r\n            if (React.isValidElement(child)) {\r\n                const { path } = child.props;\r\n                const matched = location.pathname.match(`^${path}$`);\r\n                const style = {};\r\n                if (!matched) {\r\n                    style.display = 'none';\r\n                }\r\n                const instance = cache[path];\r\n                return (React.createElement(\"div\", { style: style, key: path }, instance));\r\n            }\r\n            return null;\r\n        });\r\n    }, [cache, location, children]);\r\n    return React.createElement(React.Fragment, null, rendered);\r\n});\r\n"]}]}